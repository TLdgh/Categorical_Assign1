---
title: "MAT5317 Categorical Assignment 1"
author: 
  - Teng Li(7373086)
  - Zhize Lu(300075114) 
  - Chutong Zhang(300311325)
output: 
  pdf_document: 
    latex_engine: xelatex
    keep_tex: true
    includes:
      in_header: columns.tex
fontsize: 11pt
header-includes: 
  - \renewcommand{\and}{\\}
  - \usepackage{float}
  - \floatplacement{figure}{H}
bibliography: References.bib
link-citations: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Introduction
We were given the data set of The National Health and Nutrition Examination Survey (NHANES). The survey program has been conducted as a series of surveys designed to assess the health and nutritional status of adults and children in the United States since the 1960s, according to CDC [@CDC]. It combines in-person face-to-face interviews and physical examinations of participants for data collection. 

The survey data wasn't a simple random sample, however. According to CDC's National Health and Nutrition Examination Survey: Plan and Operations, 1999â€“2010 [@SurveyDesign], the sampling strategy consists of several stages: 1. Selection of counties as primary sampling units (PSU). 2. selection of segments within PSUs that constitute blocks of households. 3. Selection of specific households within segments. 4. Selection of individuals within a household. 

We aim to study the relationship between the weight variable and the other health related variables of the data.

# Method
We began our study by doing an exploratory analysis among the variables through various tables and charts. We then performed several hypothesis tests on some of the variables. Lastly we did a linear regression model fit to the response variable "weight" with other variables and confounders.

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
library(plotly)
library(tidyverse)
library(kableExtra)
library(aplore3)
```

```{r}
#create data variable definition
DataDict<-data.frame(
  Variables=colnames(nhanes), 
  Type=sapply(nhanes, function(x) class(x)),
  Example=sapply(nhanes, function(x) paste(as.character(head(unique(x),3)), collapse = ", ")),
  Number.Unique=sapply(nhanes, function(x) length(unique(na.omit(x)))),
  MissingPct=sapply(nhanes, function(x) paste0(round(sum(is.na(x))/nrow(nhanes)*100,2), "%")),
  Comment=c("Identification Code (1 - 6482)",
            "Gender (1: Male, 2: Female)",
            "Age (Years)",
            "Marital Status (1: Married, 2: Widowed, 3: Divorced, 4: Separated, 5: Never Married, 6: Living Together)",
            "Statistical Weight (4084.478 - 153810.3)",
            "Pseudo-PSU (1, 2)",
            "Pseudo-Stratum (1 - 15)",
            "Total Cholesterol (mg/dL)",
            "HDL-Cholesterol (mg/dL)",
            "Systolic Blood Pressure (mm Hg)",
            "Diastolic Blood Pressure (mm Hg)",
            "Weight (kg)", 
            "Standing Height (cm)",  
            "Body mass Index (Kg/m^2)",
            "Vigorous Work Activity (1: Yes, 2: No)",
            "Moderate Work Activity (1: Yes, 2: No)",
            "Walk or Bicycle (1: Yes, 2: No)",
            "Vigorous Recreational Activities (1: Yes, 2: No)",
            "Moderate Recreational Activities (1: Yes, 2: No)",
            "Minutes of Sedentary Activity per Week (0 - 840)",
            "BMI>35 (1: No, 2: Yes)")
)

DataDict%>%remove_rownames()%>%kable(booktabs = TRUE,caption = "Data Variable Definition")%>%
  kable_styling(font_size=10, latex_options=c("striped","scale_down","hold_position"))%>%
  column_spec(4, width = "8em")%>%
  row_spec(0,bold=TRUE)
```

We first test the independence between obesity and marital status. We form the following contingency table:

```{r}
data1<-nhanes%>%select(wt, marstat, obese)%>%na.omit()
head(data1)

data1%>%group_by(across(marstat:obese, as.factor))%>%tally()%>%spread(key=obese, value=n)%>%
  rename("\t" = marstat) %>% 
  add_column(" " = c("Marital Status", rep(" ", nrow(.) - 1)), .before = "\t") %>% 
  kable(booktabs = TRUE,caption = "Contingency Table")%>%
  kable_styling(font_size=10, latex_options=c("hold_position"), full_width = F)%>%
  add_header_above(c(" " = 1, " " = 1, "Obesity" = 2))
```

Given the categories of marriage, we are interested in the number of obese people in each category. We have six categories in total. This forms a Multinomial random variable $\vec{X}=(X_1,... ,X_6)$ where each $X_i$ is the number of obese people in category i. We get the estimates of the MLEs for the corresponding proportions:
```{r}
df1<-data1%>%group_by(across(marstat:obese, as.factor))%>%tally()%>%spread(key=obese, value=n)%>%mutate(p_mle=Yes/sum(No+Yes))
df1
```
The covariance matrix of the MLE is:
$$
Cov(\hat{p_1}, \hat{p_2})=
\begin{bmatrix}
\frac{p_1(1-p_1)}{n_1} & ... &  -\frac{n}{n_1n_k}p_1p_k\\
-\frac{n}{n_kn_1} p_1p_k & ... & \frac{p_k(1-p_k)}{n_k}
\end{bmatrix}
$$

```{r}
cov<-matrix(rep(0,36), nrow = 6, dimnames = list(df1$marstat,df1$marstat))

for(i in 1:6){
  for(j in 1:6){
    if(i==j){cov[i,j]<-as.numeric(df1[i, "p_mle"]*(1-df1[i, "p_mle"]))/sum(df1[i, c("No", "Yes")])}
    else{cov[i,j]<- -as.numeric(sum(df1[, c("No", "Yes")])/(sum(df1[i, c("No", "Yes")])*sum(df1[j, c("No", "Yes")]))*df1[i, "p_mle"]*df1[j, "p_mle"])}
  }
}
cov%>%round(6)
```

We are interested in testing the following hypothesis:

\begin{gather*}
H_0: p\\
H_1:p2
\end{gather*}








# Conclusion

# References
