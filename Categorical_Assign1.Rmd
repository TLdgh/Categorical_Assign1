---
title: "MAT5317 Categorical Assignment 1"
author: 
  - Teng Li(7373086)
  - Zhize Lu(300075114) 
  - Chutong Zhang(300311325)
output: 
  pdf_document: 
    keep_tex: true
    includes:
      in_header: columns.tex
fontsize: 11pt
header-includes: 
  - \renewcommand{\and}{\\}
  - \usepackage{float}
  - \floatplacement{figure}{H}
bibliography: References.bib
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Introduction

We were given the data set of The National Health and Nutrition Examination Survey (NHANES). The survey program has been conducted as a series of surveys designed to assess the health and nutritional status of adults and children in the United States since the 1960s, according to CDC [@CDC]. It combines in-person face-to-face interviews and physical examinations of participants for data collection.

The survey data wasn't a simple random sample, however. According to CDC's National Health and Nutrition Examination Survey: Plan and Operations, 1999--2010 [@SurveyDesign], the sampling strategy consists of several stages: 1. Selection of counties as primary sampling units (PSU). 2. selection of segments within PSUs that constitute blocks of households. 3. Selection of specific households within segments. 4. Selection of individuals within a household.

We aim to study the relationship between the weight variable and the other health related variables of the data.

# Method

We began our study by doing an exploratory analysis among the variables through various tables and charts. We then performed several hypothesis tests on some of the variables. Lastly we did a linear regression model fit to the response variable "weight" with other variables and confounders.

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
library(plotly)
library(tidyverse)
library(kableExtra)
library(aplore3)
```

```{r}
#create data variable definition
DataDict<-data.frame(
  Variables=colnames(nhanes), Size=nrow(nhanes), 
  Type=sapply(nhanes, function(x) class(x)),
  Example=sapply(nhanes, function(x) paste(as.character(head(unique(x),3)), collapse = ", ")),
  Number.Unique=sapply(nhanes, function(x) length(unique(na.omit(x)))),
  Number.Missing=sapply(nhanes, function(x) sum(is.na(x))),
  Comment=c("Identification Code (1 - 6482)",
            "Gender (1: Male, 2: Female)",
            "Age (Years)",
            "Marital Status (1: Married, 2: Widowed, 3: Divorced, 4: Separated, 5: Never Married, 6: Living Together)",
            "Statistical Weight (4084.478 - 153810.3)",
            "Pseudo-PSU (1, 2)",
            "Pseudo-Stratum (1 - 15)",
            "Total Cholesterol (mg/dL)",
            "HDL-Cholesterol (mg/dL)",
            "Systolic Blood Pressure (mm Hg)",
            "Diastolic Blood Pressure (mm Hg)",
            "Weight (kg)", 
            "Standing Height (cm)",  
            "Body mass Index (Kg/m^2)",
            "Vigorous Work Activity (1: Yes, 2: No)",
            "Moderate Work Activity (1: Yes, 2: No)",
            "Walk or Bicycle (1: Yes, 2: No)",
            "Vigorous Recreational Activities (1: Yes, 2: No)",
            "Moderate Recreational Activities (1: Yes, 2: No)",
            "Minutes of Sedentary Activity per Week (0 - 840)",
            "BMI>35 (1: No, 2: Yes)")
)

DataDict%>%remove_rownames()%>%kable(booktabs = TRUE,caption = "Data Variable Definition")%>%
  kable_styling(font_size=10, latex_options=c("striped","scale_down","hold_position"))%>%
  column_spec(4, width = "8em")%>%
  row_spec(0,bold=TRUE)
```

Based on thresholds established by clinicians, we categorizing four variables related to the cholesterol and blood pressure level.

(add two tables showing the thresholds for cholesterol and blood pressure level)

```{r}

nhanes_data <- nhanes

#discretize columns related to Cholesterol and blood pressure
nhanes_data$tchol_cat <- cut(nhanes_data$tchol, 
                             breaks = c(0, 199, 239, Inf), 
                             labels = c("Acceptable", "Borderline", "Abnormal"))

nhanes_data$hdl_cat <- cut(nhanes_data$hdl, 
                           breaks = c(0, 39, 59, Inf), 
                           labels = c("Abnormal", "Borderline", "Acceptable"))

nhanes_data$sysbp_cat <- cut(nhanes_data$sysbp, 
                             breaks = c(-Inf, 119.9, 129.9, 139.9, 179.9, Inf),
                             labels = c("NORMAL", "ELEVATED", "HYPERTENSION STAGE 1", 
                                        "HYPERTENSION STAGE 2", "HYPERTENSIVE CRISIS"))

nhanes_data$dbp_cat <- cut(nhanes_data$dbp, 
                           breaks = c(-Inf, 79.9, 89.9, 119.9, Inf),
                           labels = c("NORMAL", "HYPERTENSION STAGE 1", 
                                      "HYPERTENSION STAGE 2", "HYPERTENSIVE CRISIS"))

#show example of modified data'
set.seed(123)
examples_data <- nhanes_data[sample(nrow(nhanes_data), 5), c("tchol", "tchol_cat", "hdl", "hdl_cat", "sysbp", "sysbp_cat", "dbp", "dbp_cat")]
knitr::kable(examples_data, 
             caption = "Examples of Original and Discretized Health Metrics",
             align = "c")
```

```{r}
library(knitr)
library(kableExtra)

# Omit rows with any NA values
nhanes_data_clean <- nhanes_data[complete.cases(nhanes_data), ]

# Function to generate detailed statistics for a given variable

generate_detailed_summary <- function(var_name, data) {
  # Remove the "_cat" suffix
  display_var_name <- gsub("_cat", "", var_name)
  
  levels_of_var <- unique(data[[var_name]])
  summaries <- lapply(levels_of_var, function(level) {
    total_count <- sum(data[[var_name]] == level, na.rm = TRUE)
    total_percentage <- (total_count / nrow(data)) * 100
    
    healthy_count <- sum(data[[var_name]][data$weight_category == "Healthy"] == level, na.rm = TRUE)
    healthy_percentage <- (healthy_count / sum(data$weight_category == "Healthy", na.rm = TRUE)) * 100
    
    obese_count <- sum(data[[var_name]][data$weight_category == "Obese"] == level, na.rm = TRUE)
    obese_percentage <- (obese_count / sum(data$weight_category == "Obese", na.rm = TRUE)) * 100
    
    data.frame(
      SampleCharacteristic = as.character(level),
      Total = paste0(total_count, " (", sprintf("%.2f", total_percentage), "%)"),
      Healthy = paste0(healthy_count, " (", sprintf("%.2f", healthy_percentage), "%)"),
      Obese = paste0(obese_count, " (", sprintf("%.2f", obese_percentage), "%)")
    )
  })
  
  # Add the primary heading for the variable, bolded
  primary_heading <- data.frame(SampleCharacteristic = paste0("**", display_var_name, "**"), Total = "", Healthy = "", Obese = "")
  rbind(primary_heading, do.call(rbind, summaries))
}

vars_to_summarize <- c("gender", "marstat", "psu", "vigwrk", "modwrk", "wlkbik", "vigrecexr", "modrecexr", 
                       "tchol_cat", "hdl_cat", "sysbp_cat", "dbp_cat")

summary_table <- do.call(rbind, lapply(vars_to_summarize, generate_detailed_summary, data = nhanes_data_clean))
knitr::kable(summary_table, 
             caption = "Table 1: Descriptive Summary by Weight Category", 
             align = c('l', 'c', 'c', 'c'),
             row.names = FALSE, 
             format.args = list(big.mark = ","),
             col.names = c('Sample Characteristic', 'Total', 'Healthy (BMI < 35)', 'Obese (BMI >= 35)'))

```



# Conclusion

# References
