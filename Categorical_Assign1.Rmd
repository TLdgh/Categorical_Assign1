---
title: "MAT5317 Categorical Assignment 1"
author: 
  - Teng Li(7373086)
  - Zhize Lu(300075114) 
  - Chutong Zhang(300311325)
output: 
  pdf_document: 
    keep_tex: true
    includes:
      in_header: columns.tex
fontsize: 11pt
header-includes: 
  - \renewcommand{\and}{\\}
  - \usepackage{float}
  - \floatplacement{figure}{H}
bibliography: References.bib
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Introduction

We were given the data set of The National Health and Nutrition Examination Survey (NHANES). The survey program has been conducted as a series of surveys designed to assess the health and nutritional status of adults and children in the United States since the 1960s, according to CDC [@CDC]. It combines in-person face-to-face interviews and physical examinations of participants for data collection.

The survey data wasn't a simple random sample, however. According to CDC's National Health and Nutrition Examination Survey: Plan and Operations, 1999--2010 [@SurveyDesign], the sampling strategy consists of several stages: 1. Selection of counties as primary sampling units (PSU). 2. selection of segments within PSUs that constitute blocks of households. 3. Selection of specific households within segments. 4. Selection of individuals within a household.

We aim to study the relationship between the weight variable and the other health related variables of the data.

# Method

We began our study by doing an exploratory analysis among the variables through various tables and charts. We then performed several hypothesis tests on some of the variables. Lastly we did a linear regression model fit to the response variable "weight" with other variables and confounders.

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
library(plotly)
library(tidyverse)
library(kableExtra)
library(aplore3)
library(ggplot2)
```

```{r}
#create data variable definition
DataDict<-data.frame(
  Variables=colnames(nhanes), Size=nrow(nhanes), 
  Type=sapply(nhanes, function(x) class(x)),
  Example=sapply(nhanes, function(x) paste(as.character(head(unique(x),3)), collapse = ", ")),
  Number.Unique=sapply(nhanes, function(x) length(unique(na.omit(x)))),
  Number.Missing=sapply(nhanes, function(x) sum(is.na(x))),
  Comment=c("Identification Code (1 - 6482)",
            "Gender (1: Male, 2: Female)",
            "Age (Years)",
            "Marital Status (1: Married, 2: Widowed, 3: Divorced, 4: Separated, 5: Never Married, 6: Living Together)",
            "Statistical Weight (4084.478 - 153810.3)",
            "Pseudo-PSU (1, 2)",
            "Pseudo-Stratum (1 - 15)",
            "Total Cholesterol (mg/dL)",
            "HDL-Cholesterol (mg/dL)",
            "Systolic Blood Pressure (mm Hg)",
            "Diastolic Blood Pressure (mm Hg)",
            "Weight (kg)", 
            "Standing Height (cm)",  
            "Body mass Index (Kg/m^2)",
            "Vigorous Work Activity (1: Yes, 2: No)",
            "Moderate Work Activity (1: Yes, 2: No)",
            "Walk or Bicycle (1: Yes, 2: No)",
            "Vigorous Recreational Activities (1: Yes, 2: No)",
            "Moderate Recreational Activities (1: Yes, 2: No)",
            "Minutes of Sedentary Activity per Week (0 - 840)",
            "BMI>35 (1: No, 2: Yes)")
)

DataDict%>%remove_rownames()%>%kable(booktabs = TRUE,caption = "Data Variable Definition")%>%
  kable_styling(font_size=10, latex_options=c("striped","scale_down","hold_position"))%>%
  column_spec(4, width = "8em")%>%
  row_spec(0,bold=TRUE)
```



```{r}
#Table 1 (Option 1)
#install_github("emwozniak/Table1")
library(Table1)
make.table(dat          = nhanes,
           strat        = "obese",
           cat.varlist  = c("gender","marstat","vigwrk","modwrk","wlkbik","vigrecexr","modrecexr"),
           cont.varlist = c("age","samplewt","psu","strata","tchol","hdl","sysbp","dbp","wt","ht","bmi","sedmin"),
           colnames     = c(" ", "Not Obese", "Obese", "Overall"),
           caption      = "Table 1: Characteristics of the data set NHANES ",
           output       = "html")

#Table 1 (Option 2)
#install.packages("table1")
library(table1)
Bnhanes<-nhanes
label(Bnhanes$gender) <- "Gender"
label(Bnhanes$age)<-"Age"
label(Bnhanes$marstat)<-"Marital Status"
label(Bnhanes$samplewt)<-"Statistical Weight"
label(Bnhanes$psu)<-"Pseudo-PSU"
label(Bnhanes$strata)<-"Pseudo-stratum"
label(Bnhanes$tchol)<-"Total Cholesterol"
label(Bnhanes$hdl)<-"HDL-Cholesterol"
label(Bnhanes$sysbp)<-"Systolic Blood Pressure"
label(Bnhanes$dbp)<-"Diastolic Blood Pressure "
label(Bnhanes$wt)<-"Weight"
label(Bnhanes$ht)<-"Standing Height"
label(Bnhanes$bmi)<-"Body mass Index"
label(Bnhanes$vigwrk)<-"Vigorous Work Activity"
label(Bnhanes$modwrk)<-"Moderate Work Activity "
label(Bnhanes$wlkbik)<-"Walk or Bicycle "
label(Bnhanes$vigrecexr)<-"Vigorous Recreational Activities "
label(Bnhanes$modrecexr)<-"Moderate Recreational Activities"
label(Bnhanes$sedmin)<-"Minutes of Sedentary Activity per Week "
label(Bnhanes$obese)<-"Obese "

units(Bnhanes$age) <- "years"
units(Bnhanes$tchol) <- "mg/dL"
units(Bnhanes$hdl) <- "mg/dL"
units(Bnhanes$sysbp) <- "mm Hg"
units(Bnhanes$dbp) <- "mm Hg"
units(Bnhanes$wt) <- "Kg"
units(Bnhanes$ht) <- "cm"
units(Bnhanes$bmi) <- "Kg/m^2"
units(Bnhanes$sedmin) <- "mins"

table1 (~ age+marstat+samplewt+psu+strata+tchol+hdl+sysbp+dbp+wt+ht+vigwrk+modwrk+wlkbik+vigrecexr+modrecexr+sedmin+obese | gender, data=Bnhanes)
```

From the table 1, we can realized that there are 6482 observations with 21 variables in our data set and 8 variables can be considered as categorical variables. This data set mainly focus on the observers between 16 to 80 years old. Among them, the average weight for male is greater than female among all ages, and as we can see from the line chart that the change in average weight with age follow the same trend across the gender, with a general tendency to sustained increase, followed by fluctuation and continuous decrease finally.
```{r}
#exploratory average weight in every age grouped by gender
gender<-nhanes%>%
  group_by(gender,age)%>%
  summarise(Avgwt=mean(wt,na.rm=TRUE))
   ggplot(gender,aes(x=age, y=Avgwt), group=gender)+
     geom_point(aes(colour=gender),size=1 )+
     geom_line(aes(fill=gender,colour=gender,linetype=gender) )+
      scale_y_continuous( labels = scales::comma  ) +
    theme(axis.text.x = element_text(size =7, vjust = 0.5, hjust = 0.5, angle = 45))+
   
   labs(title="Average Weight in Different Age",x="Age", y="Average weight (Kg)")+
   theme(plot.title = element_text(hjust = 0.5))
```

For the observations in different marital status, we also interested in the relationship between weight and marital status.The following box plot shows that the average weight under different marital status are all around 80 Kg, widowed have lowest average weight among six categories.
```{r}
#box plot for weight VS marital status
Nhanes<-nhanes%>%
  na.omit()
ggplot(Nhanes, aes(x=marstat, y=wt, fill=marstat))+
        geom_boxplot() + 
        scale_fill_brewer(palette="Blues") +
        labs(title = "Plot for weight in each marital status", x="Marital Status", y="Weight (Kg)")+
        theme(axis.text.x = element_text(size =7, vjust = 0.5, hjust = 0.5, angle = 45),
              plot.title = element_text(hjust = 0.5)
       )

  
#boxplot for vigorous activities VS weight
Nhanes<-nhanes%>%
  mutate(vigrecexr = case_when(
    (nhanes$vigrecexr %in% "Yes") ~ "Vigorous Recreational Activities",
    (nhanes$vigrecexr %in% "No") ~ "Not Vigorous Recreational Activities"))%>%
  na.omit()
  ggplot(Nhanes, aes(x=vigwrk, y=wt, fill=vigwrk))+
        geom_boxplot() + 
       facet_wrap(~vigrecexr) +
        scale_fill_brewer(palette="Blues") +
        labs(title = "Plot for weight in Vigorous Work and Recreational Activity", x=" Vigorous Work Activity", y="Weight (Kg)")+
        theme(axis.text.x = element_text(size =7, vjust = 0.5, hjust = 0.5, angle = 45),
              plot.title = element_text(hjust = 0.5)
       )
```

In order to have improve understanding with the relationship between weight and other health related variables, we can categorize the weight level for every observation by BMI.
```{r}
# categorize the BMI level (CDC standard) and age group (NIH standard)
Catenhanes<-nhanes%>%
  mutate(BMI_level = case_when(
    nhanes$bmi < 18.5 ~"Underweight",
    nhanes$bmi < 25 ~"Healthy weight",
    nhanes$bmi < 30 ~"Overweight",
    nhanes$bmi >= 35 ~"Obesity "),
   group=case_when(
     nhanes$age < 18 ~ "Adolescents",
     nhanes$age < 65 ~ "Adults",
     nhanes$age >=65 ~ "Older Adults"
   ))

```



# Conclusion

# References
